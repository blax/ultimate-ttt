function FieldModel(o,r,e,n){var t=this;t.x=o,t.y=r,t.parent=e,t.state=ko.observable(n||" "),t.isLastMove=ko.computed(function(){return t.parent.parent.isLastMove(t)})}function ticTacToeWinner(o){for(var r={O:0,X:0},e={O:0,X:0},n=0;3>n;n++){for(var t={O:0,X:0},a={O:0,X:0},i=0;3>i;i++)t[o[n][i]]++,a[o[i][n]]++;if(t.O==3||a.O==3)return"O";if(t.X==3||a.X==3)return"X";r[o[n][n]]++,e[o[n][2-n]]++}return r.O==3||e.O==3?"O":r.X==3||e.X==3?"X":!1}function BigBoardModel(){var o=this;o.nextSmallBoard=ko.observable(null),o.lastMove=ko.observable(null),o.nextMove=ko.observable("O"),o.switchMove=function(){o.nextMove(o.nextMove()=="O"?"X":"O")},o.isLastMove=function(r){return r===o.lastMove()},o.makeMove=function(r){var e=!o.nextSmallBoard()||o.nextSmallBoard()==r.parent,n=o.big_rows[r.x].big_cols[r.y];return o.winner()?!1:(e&&r.state()==" "&&(r.state(o.nextMove()),o.switchMove(),o.lastMove(r),o.nextSmallBoard(n)),e&&r.parent.isFilled()&&(o.switchMove(),o.lastMove(null),o.nextSmallBoard(n)),void 0)},o.winner=ko.computed(function(){for(var r=[],e=0;3>e;e++){for(var n=[],t=0;3>t;t++)n.push(o.big_rows[e].big_cols[t].winner());r.push(n)}return ticTacToeWinner(r)},o,{deferEvaluation:!0,disposeWhen:function(){return o.winner()}}),o.big_rows=[];for(var r=function(){for(var r=[],e=0;3>e;e++)r.push(new SmallBoardModel(o));return r},e=0;3>e;e++)o.big_rows.push({big_cols:r()})}function SmallBoardModel(o){var r=this;r.parent=o,r.rows=[];for(var e=function(o){for(var e=[],n=0;3>n;n++)e.push(new FieldModel(o,n,r," "));return e},n=0;3>n;n++)r.rows.push({cols:e(n)});r.winner=ko.computed(function(){for(var o=[],e=0;3>e;e++){for(var n=[],t=0;3>t;t++)n.push(r.rows[e].cols[t].state());o.push(n)}return ticTacToeWinner(o)},r,{deferEvaluation:!0,disposeWhen:function(){return r.winner()}}),r.boardState=ko.computed(function(){var e=o.nextSmallBoard(),n=r.winner();return n?"won-board-"+n:e&&e!==r?"inactive-board":"active-board"}),r.isFilled=ko.computed(function(){for(var o=0;3>o;o++)for(var e=0;3>e;e++)if(r.rows[o].cols[e].state()==" ")return!1;return!0})}ko.applyBindings(new BigBoardModel);