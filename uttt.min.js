function FieldModel(e,o,r,n){var t=this;t.x=e,t.y=o,t.parent=r,t.state=ko.observable(n||" "),t.isLastMove=ko.computed(function(){return t.parent.parent.isLastMove(t)})}function ticTacToeWinner(e){for(var o={O:0,X:0},r={O:0,X:0},n=0;3>n;n++){for(var t={O:0,X:0},a={O:0,X:0},i=0;3>i;i++)t[e[n][i]]++,a[e[i][n]]++;if(t.O==3||a.O==3)return"O";if(t.X==3||a.X==3)return"X";o[e[n][n]]++,r[e[n][2-n]]++}return o.O==3||r.O==3?"O":o.X==3||r.X==3?"X":!1}function BigBoardModel(){var e=this;e.nextSmallBoard=ko.observable(null),e.lastMove=ko.observable(null),e.nextMove=ko.observable("O"),e.switchMove=function(){e.nextMove(e.nextMove()=="O"?"X":"O")},e.isLastMove=function(o){return o===e.lastMove()},e.makeMove=function(o){var r=!e.nextSmallBoard()||e.nextSmallBoard()==o.parent,n=e.big_rows[o.x].big_cols[o.y];return e.winner()?!1:(r&&o.state()==" "&&(o.state(e.nextMove()),e.switchMove(),e.lastMove(o),e.nextSmallBoard(n)),r&&o.parent.isFilled()&&(e.switchMove(),e.lastMove(null),e.nextSmallBoard(n)),void 0)},e.winner=ko.computed(function(){for(var o=[],r=0;3>r;r++){for(var n=[],t=0;3>t;t++)n.push(e.big_rows[r].big_cols[t].winner());o.push(n)}return ticTacToeWinner(o)},e,{deferEvaluation:!0,disposeWhen:function(){return e.winner()}}),e.big_rows=[];for(var o=function(){for(var o=[],r=0;3>r;r++)o.push(new SmallBoardModel(e));return o},r=0;3>r;r++)e.big_rows.push({big_cols:o()})}function SmallBoardModel(e){var o=this;o.parent=e,o.rows=[];for(var r=function(e){for(var r=[],n=0;3>n;n++)r.push(new FieldModel(e,n,o," "));return r},n=0;3>n;n++)o.rows.push({cols:r(n)});o.winner=ko.computed(function(){for(var e=[],r=0;3>r;r++){for(var n=[],t=0;3>t;t++)n.push(o.rows[r].cols[t].state());e.push(n)}return ticTacToeWinner(e)},o,{deferEvaluation:!0,disposeWhen:function(){return o.winner()}}),o.boardState=ko.computed(function(){var r=e.nextSmallBoard(),n=o.winner();return n?"won-board-"+n:o.parent.winner()||r&&r!==o?"inactive-board":"active-board"},o,{deferEvaluation:!0}),o.isFilled=ko.computed(function(){for(var e=0;3>e;e++)for(var r=0;3>r;r++)if(o.rows[e].cols[r].state()==" ")return!1;return!0})}ko.applyBindings(new BigBoardModel);